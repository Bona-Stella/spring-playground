server:
  port: 8084

spring:
  application:
    name: worker
  rabbitmq:
    host: localhost
    port: 5672
    username: guest
    password: guest
  kafka:
    bootstrap-servers: localhost:9092
    consumer:
      group-id: chat-archiver
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer
      properties:
        spring.json.trusted.packages: "*"
        spring.json.value.default.type: com.github.stella.springmsamq.common.chat.ChatPayload
    listener:
      ack-mode: record
  data:
    mongodb:
      uri: mongodb://localhost:27017/chatdb

eureka:
  client:
    service-url:
      defaultZone: http://localhost:8761/eureka
  instance:
    prefer-ip-address: true
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: never

worker:
  vthreads:
    enabled: true
  rabbit:
    concurrency: 2
  retry:
    ttl: 5000 # milliseconds, 메시지를 일정 시간 보관 후 메인으로 재유입
  idempotency:
    ttl-seconds: 86400 # 24시간, 처리 완료 이벤트 멱등성 보존 시간
  reprocess:
    batch-size: 100
    token: dev-token # 운영에서는 안전한 비밀 관리로 교체

logging:
  level:
    org.springframework.amqp: INFO
    org.springframework.kafka: INFO
